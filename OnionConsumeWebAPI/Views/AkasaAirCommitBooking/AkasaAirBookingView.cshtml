@using System.Collections;
@model DomainLayer.ViewModel.AirLinePNRTicket
@{
    var data = Model;
}


<!DOCTYPE html>
<html lang="en">
<head>
    <title>Indigo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/css/style_ticket.css" rel="stylesheet" />
    <link href="~/css/main.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style_ticket.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3/dist/JsBarcode.all.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


    <style>
        .ticketdwn img {
            cursor: pointer;
        }
    </style>


    <script type="text/javascript">
        window.jsPDF = window.jspdf.jsPDF;
        var docPDF = new jsPDF();

        function downloadPDF() {

            var elementHTML = document.querySelector("#pdfdwonloadAkasa");
            //var images = elementHTML.querySelectorAll('img');
            //images.forEach(img => img.style.display = 'none');
            var imageToHide = document.querySelector("#downicnIdAkasa");
            if (imageToHide) {
                imageToHide.style.visibility = 'hidden';
            }
            docPDF.html(elementHTML, {
                callback: function (docPDF) {
                    docPDF.save("Jetways_FlightTicket" + '.pdf');

                    if (imageToHide) {
                        imageToHide.style.visibility = '';  // Restore the specific image
                    }
                },
                x: 12,
                y: 15,
                width: 160,
                windowWidth: 820
            });
        }


    </script>
</head>
<body>
    <!---New Tikec design- Start----->

    <form asp-action="PostTicketBooking" asp-controller="AirLinesTicket" method="post">
        @{
            Hashtable htseat = Model.AirlinePNR[0].Seatdata;
            Hashtable htmeal = Model.AirlinePNR[0].Mealdata;
            Hashtable htbag = Model.AirlinePNR[0].Bagdata;
            <div class="container" id="pdfdwonloadAkasa">

                <div class="flight-tckt-main">
                    <div class="d-flex justify-content-end ticketdwn" type="button" onclick="downloadPDF()">
                        <img src="~/img/dwicon.png" style="width:40px;" id="downicnIdAkasa">
                    </div>
                    <div class="top">
                        <label>
                            <a asp-controller="FlightSearchIndex" asp-action="Index">
                                <img src="~/img/logo/logo.png" alt="brand-logo">
                            </a>
                        </label>
                        <label class="fr">
                            <h4>E-Ticket </h4>
                            Jetways Travel Booking <strong>@Model.AirlinePNR[0].bookingKey</strong> <br> PNR. <span style="color: #EF0000;font-size: 16px;font-weight: 600;">@Model.AirlinePNR[0].recordLocator</span>
                            <br> Booking Date :@Model.AirlinePNR[0].info.bookedDate <span style="font-size: 16px;font-weight: 600;"></span>
                        </label>
                    </div>
                    <h3>Itinerary and Reservation Details</h3>
                    <div class="itinerary-section">
                        <div class="col">

                            @for (int j = 0; j < @Model.AirlinePNR[0].journeys.Count; j++)
                            {
                                @for (int s = 0; s < @Model.AirlinePNR[0].journeys[j].segments.Count; s++)
                                {
                                    <div class="row x-gap-20 bdr">
                                        <div class="col-auto">
                                            <div class="logo"><img class="size-35" src="~/img/flight-logo-icon/akasa.png" alt="logo"></div>
                                        </div>
                                        <div class="col">
                                            <div class="airline-N">AkasaAir <br> @Model.AirlinePNR[0].journeys[j].segments[s].identifier.carrierCode-@Model.AirlinePNR[0].journeys[j].segments[s].identifier.identifier</div>
                                        </div>
                                        <div class="col-auto">
                                            @{
                                                string origin = "";
                                                string originairport = "";
                                                string queryorigin = Model.AirlinePNR[0].journeys[j].segments[s].designator.origin;
                                                if (Citynamelist.GetAllCityData().Where(x => x.citycode == queryorigin).SingleOrDefault() != null)
                                                {
                                                    origin = Citynamelist.GetAllCityData().Where(x => x.citycode == queryorigin).SingleOrDefault().cityname;
                                                    originairport = Citynamelist.GetAllCityData().Where(x => x.citycode == queryorigin).SingleOrDefault().airportname;
                                                }


                                                string departuretime = @Model.AirlinePNR[0].journeys[j].segments[s].designator.departure.ToString().Substring(11, 5);
                                                string departuredate = @Model.AirlinePNR[0].journeys[j].segments[s].designator.departure.ToString().Substring(0, 10);

                                                //Arrival  code
                                                string arrival = "";
                                                string arrivalairport = "";
                                                string queryarrival = Model.AirlinePNR[0].journeys[j].segments[s].designator.destination;
                                                if (Citynamelist.GetAllCityData().Where(x => x.citycode == queryarrival).SingleOrDefault() != null)
                                                {
                                                    arrival = Citynamelist.GetAllCityData().Where(x => x.citycode == queryarrival).SingleOrDefault().cityname;
                                                    arrivalairport = Citynamelist.GetAllCityData().Where(x => x.citycode == queryarrival).SingleOrDefault().airportname;
                                                }

                                                string arrivaltime = @Model.AirlinePNR[0].journeys[j].segments[s].designator.arrival.ToString().Substring(11, 5);
                                                string arrivaldate = @Model.AirlinePNR[0].journeys[j].segments[s].designator.arrival.ToString().Substring(0, 10);
                                            }
                                            <div class="Dst-name">
                                                <span class="red">@origin</span> @departuretime <span>
                                                    <strong>@departuredate</strong>
                                                </span> <span>Terminal - @Model.AirlinePNR[0].journeys[j].segments[s].legs[0].legInfo.departureTerminal</span>
                                                <span>@originairport</span>
                                            </div>
                                        </div>

                                        <div class="col-auto text-center">
                                            @{

                                                string formattedTime = string.Empty;
                                                var arrivalDate = Model.AirlinePNR[0].journeys[j].segments[s].designator.arrival;
                                                var departureDate = Model.AirlinePNR[0].journeys[j].segments[s].designator.departure;
                                                var diff = (arrivalDate - departureDate);
                                                TimeSpan timeSpan = TimeSpan.Parse(diff.ToString());
                                                if ((int)timeSpan.Minutes == 0)
                                                    formattedTime = $"{(int)timeSpan.TotalHours} h";
                                                else
                                                    formattedTime = $"{(int)timeSpan.TotalHours} h {(int)timeSpan.Minutes} m";
                                            }
                                            <div class="time">@formattedTime</div>
                                            <img src="~/img/arrow-line-fr.png" alt="icon">
                                           
                                        </div>

                                        <div class="col">
                                            <div class="Dst-name">
                                                <span class="red">@arrival</span> @arrivaltime <span><strong>@arrivaldate</strong></span> <span>Terminal - @Model.AirlinePNR[0].journeys[j].segments[s].legs[0].legInfo.arrivalTerminal</span>
                                                <span>@arrivalairport</span>
                                            </div>
                                        </div>
                                    </div>
                                }

                            }

                        </div>
                    </div>


                    <div class="ticket-info">
                        <h3>PASSENGER AND TICKET INFORMATION </h3>
                        <table class="table table-bordered">
                            <thead>
                                <tr>

                                    <th rowspan="2" class="align-middle">Passenger</th>
                                    <th colspan="2" class="text-center">Fllight Detail</th>
                                    <th rowspan="2" class="align-middle">Seat No</th>
                                    <th rowspan="2" class="align-middle">Mobile Number</th>
                                    <th rowspan="2" class="align-middle">Ticket Number</th>
                                    <th rowspan="2" class="align-middle">Status</th>
                                    <th rowspan="2" class="align-middle barcode">Bar code</th>
                                </tr>
                                <tr>
                                    <th class="col-one">Sector</th>
                                    <th class="col-one">Airline</th>

                                </tr>
                            </thead>

                            <tbody>
                                @for (int p = 0; p < Model.AirlinePNR[0].passengers.Count; p++)
                                {
                                    @for (int ps = 0; ps < @Model.AirlinePNR[0].journeys[0].segments.Count; ps++)
                                    {
                                        <tr>
                                            @{
                                                if (ps == 0)
                                                {
                                                    int segmentscount = @Model.AirlinePNR[0].journeys[0].segments.Count;
                                                    if (segmentscount == 1)
                                                    {
                                                        <td rowspan="1" style="vertical-align:middle;">@Model.AirlinePNR[0].passengers[p].name.first (@Model.AirlinePNR[0].passengers[p].passengerTypeCode)</td>
                                                    }

                                                    if (segmentscount == 2)
                                                    {
                                                        <td rowspan="2" style="vertical-align:middle;">@Model.AirlinePNR[0].passengers[p].name.first (@Model.AirlinePNR[0].passengers[p].passengerTypeCode)</td>
                                                    }
                                                }


                                            }
                                            <td>@Model.AirlinePNR[0].journeys[0].segments[ps].designator.origin - @Model.AirlinePNR[0].journeys[0].segments[ps].designator.destination </td>
                                            <td>@Model.AirlinePNR[0].journeys[0].segments[ps].identifier.carrierCode - @Model.AirlinePNR[0].journeys[0].segments[ps].identifier.identifier</td>

                                            @{
                                                string hashdata = Model.AirlinePNR[0].passengers[p].passengerKey + "_" + @Model.AirlinePNR[0].journeys[0].segments[ps].designator.origin + "_" + @Model.AirlinePNR[0].journeys[0].segments[ps].designator.destination;

                                                if (htseat != null)
                                                {
                                                    <td>@htseat[hashdata]</td>
                                                }
                                            }
                                            <td>@Model.AirlinePNR[0].passengers[p].MobNumber</td>
                                            <td>AD1WSM/1/1</td>
                                            <td>Confirm</td>
                                            @if (ps == 0)
                                            {
                                                int segmentcount = @Model.AirlinePNR[0].journeys[0].segments.Count;
                                                if (segmentcount == 1)
                                                {
                                                    <td rowspan="1" style="vertical-align:middle;width:110px;">

                                                        @{
                                                            var imageUrl1 = @Model.AirlinePNR[0].passengers[p].barcodestring;
                                                            // string imageUrl1 = ViewData["ImageBytes"] as string;
                                                            string barcode = ViewData["Barcode"] as string;
                                                        }
                                                        @if (Model.AirlinePNR[0].passengers[p].passengerTypeCode == "ADT" || Model.AirlinePNR[0].passengers[p].passengerTypeCode == "CHD")
                                                        {
                                                            @if (!string.IsNullOrEmpty(imageUrl1))
                                                            {
                                                                <img src="@imageUrl1" alt="barcode" />
                                                            }
                                                        }
                                                    </td>
                                                }
                                                if (segmentcount == 2)
                                                {
                                                    <td rowspan="2" style="vertical-align:middle;width:110px;">
                                                        @{
                                                            var imageUrl1 = @Model.AirlinePNR[0].passengers[p].barcodestring;
                                                            // string imageUrl1 = ViewData["ImageBytes"] as string;
                                                            string barcode = ViewData["Barcode"] as string;
                                                        }
                                                        @if (Model.AirlinePNR[0].passengers[p].passengerTypeCode == "ADT" || Model.AirlinePNR[0].passengers[p].passengerTypeCode == "CHD")
                                                        {
                                                            @if (!string.IsNullOrEmpty(imageUrl1))
                                                            {
                                                                <img src="@imageUrl1" alt="barcode" />
                                                            }
                                                        }
                                                    </td>
                                                }
                                            }
                                        </tr>
                                    }
                                }

                            </tbody>

                        </table>
                    </div>
                    <div class="Flight-Inclusion">
                        <h3>Flight Inclusion</h3>
                        <table class="table table-bordered" style="margin-bottom: 0.4rem;">
                            <thead>
                                <tr>
                                    <th rowspan="2" class="align-middle">Passenger</th>
                                    <th colspan="2" class="text-center">Fllight Detail</th>
                                    <th rowspan="2" class="align-middle">Meal Type</th>
                                    <th rowspan="2" class="align-middle">Extra Bag(Kg)</th>
                                    <th rowspan="2" class="align-middle">Insurance Status</th>
                                </tr>
                                <tr>
                                    <th class="col-one">Sector</th>
                                    <th class="col-one">Airline</th>

                                </tr>
                            </thead>

                            <tbody>
                                @for (int i2 = 0; i2 < Model.AirlinePNR[0].passengers.Count; i2++)
                                {
                                    @for (int i3 = 0; i3 < @Model.AirlinePNR[0].journeys[0].segments.Count; i3++)
                                    {
                                        <tr>
                                            @{
                                                if (i3 == 0)
                                                {
                                                    int segmentcount = @Model.AirlinePNR[0].journeys[0].segments.Count;
                                                    if (segmentcount == 1)
                                                    {
                                                        <td rowspan="1" style="vertical-align:middle;">@Model.AirlinePNR[0].passengers[i2].name.first (@Model.AirlinePNR[0].passengers[i2].passengerTypeCode)</td>
                                                    }
                                                    if (segmentcount == 2)
                                                    {
                                                        <td rowspan="2" style="vertical-align:middle;">@Model.AirlinePNR[0].passengers[i2].name.first (@Model.AirlinePNR[0].passengers[i2].passengerTypeCode)</td>
                                                    }
                                                }

                                            }
                                            <td>@Model.AirlinePNR[0].journeys[0].segments[i3].designator.origin - @Model.AirlinePNR[0].journeys[0].segments[i3].designator.destination </td>
                                            <td>@Model.AirlinePNR[0].journeys[0].segments[i3].identifier.carrierCode - @Model.AirlinePNR[0].journeys[0].segments[i3].identifier.identifier</td>

                                            @{
                                                string hashdata = @Model.AirlinePNR[0].passengers[i2].passengerKey + "_" + @Model.AirlinePNR[0].journeys[0].segments[i3].designator.origin + "_" + @Model.AirlinePNR[0].journeys[0].segments[i3].designator.destination;

                                                if (htmeal != null)
                                                {
                                                    <td>@htmeal[hashdata]</td>
                                                }
                                                string hashBagdata = @Model.AirlinePNR[0].passengers[i2].passengerKey + "_" + @Model.AirlinePNR[0].journeys[0].segments[i3].designator.origin + "_" + @Model.AirlinePNR[0].journeys[0].segments[i3].designator.destination;
                                                if (htbag != null)
                                                {
                                                    <td>@htbag[hashBagdata]</td>
                                                }
                                            }
                                            <td>Confirm</td>
                                        </tr>
                                    }
                                }
                            </tbody>

                        </table>

                        @if (@Model.AirlinePNR[0].customerNumber != null)
                        {
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th scope="col">Company Number </th>
                                        <th scope="col" class="col-one">GST NUmber</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        @{
                                            <td>@Model.AirlinePNR[0].companyName</td>
                                            <td>@Model.AirlinePNR[0].customerNumber</td>
                                        }
                                    </tr>
                                </tbody>
                            </table>
                        }

                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col" style="background:none; text-align:center;">Fare Details</th>
                                    <th scope="col" style="background:none; text-align:center;">Amount (INR)</th>

                                </tr>
                            </thead>
                            <tbody class="fare">
                                @if (Model.AirlinePNR[0].breakdown.totalAmountSum > 0)
                                {
                                    <tr>
                                        <td>Total Basic Fare:</td>
                                        <td>Rs.@Model.AirlinePNR[0].breakdown.totalAmountSum</td>
                                    </tr>
                                }
                                else if (Model.AirlinePNR[0].breakdown.baseTotalAmount > 0)
                                {
                                    <tr>
                                        <td>Total Basic Fare:</td>
                                        <td>Rs.@Model.AirlinePNR[0].breakdown.baseTotalAmount</td>
                                    </tr>

                                }
                                @if (Model.AirlinePNR[0].breakdown.totaltax > 0)
                                {
                                    <tr>
                                        <td>Airline taxes and fees</td>
                                        <td>Rs. @Model.AirlinePNR[0].breakdown.totaltax</td>
                                    </tr>
                                }
                                else if (Model.AirlinePNR[0].breakdown.BaseTotalTax > 0)
                                {
                                    <tr>
                                        <td>Airline taxes and fees</td>
                                        <td>Rs.@Model.AirlinePNR[0].breakdown.BaseTotalTax</td>
                                    </tr>

                                }
                                <tr>
                                    <td>Discount:</td>
                                    <td>Rs.(-) 0.00</td>
                                </tr>
                                <tr>
                                    <td>Insurance Fee:</td>
                                    <td>Rs. 0.00</td>
                                </tr>
                                <tr>
                                    <td>Addon Meal Amount:</td>
                                    <td>Rs.@Model.AirlinePNR[0].TotalAmountMeal</td>
                                </tr>
                                <tr>
                                    <td>Addon Bagg Amount:</td>
                                    <td>Rs.@Model.AirlinePNR[0].TotaAmountBaggage</td>
                                </tr>
                                <tr>
                                    <td>Seat Amount:</td>
                                    <td>Rs. @Model.AirlinePNR[0].breakdown.passengerTotals.seats.totalSeatAmount</td>
                                </tr>


                                <tr style="background:#FCE1E1;">
                                    <td style="text-transform:uppercase;"><strong>total</strong></td>
                                    <td><strong>Rs. @Model.AirlinePNR[0].breakdown.balanceDue</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="t-c">
                        <h3 style="color:inherit;">Terms &amp; Conditions:</h3>
                        <ul>
                            <li><span>-&nbsp;&nbsp;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi dignissim Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi dignissim</li>
                            <li><span>-&nbsp;&nbsp;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi dignissim Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi dignissim</li>
                            <li><span>-&nbsp;&nbsp;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi dignissim consectetur adipiscing elit. Morbi dignissim</li>
                            <li><span>-&nbsp;&nbsp;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi dignissim Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi dignissim</li>
                            <li><span>-&nbsp;&nbsp;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi dignissim consectetur adipiscing elit. Morbi dignissim</li>
                            <li><span>-&nbsp;&nbsp;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi dignissim Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi dignissim</li>
                        </ul>
                    </div>
                    <div class="btm">Jetways Travels, UGF 5, Indra Prakash Building 21, B.K. Road, Connaught Place, New Delhi 110001. <strong>+91-9090909090</strong></div>
                </div>
            </div>


        }
    </form>
    <!---New ticket Design End------>


</body>
</html>













