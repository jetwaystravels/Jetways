@model DomainLayer.ViewModel.ViewModel

@{
    Layout = null;
    var data = Model;
}

<aside class="sidebar">
    <div class="row y-gap-40">
        <div class="sidebar__item">
            <h5 class="text-18 fw-600 mb-10">Popular Filters</h5>
            <div class="sidebar-checkbox">

                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">
                        <div class="d-flex items-center">
                            <div class="form-checkbox ">

                                @* <input type="checkbox" class="selectCheckboxnon" value="0" name="stops" onclick="OnewayFunctionFirst()"> *@
                                <input type="checkbox" class="selectCheckboxNew" name="stops" value="0" onclick="getFiltered()">
                                <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>
                            <div class="text-15 ml-10">Nonstop</div>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="text-15 text-light-1">₹12,997</div>
                    </div>
                </div>

                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="checkdepart" name="morningDeparture" data-departure="before_6am" onclick="OnewayFunctionTimeFilter()">
                                <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>

                            <div class="text-15 ml-10">Morning Departures</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">₹14,997</div>
                    </div>
                </div>
                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                             @*    <input type="checkbox" class="selectCheckboxAirLine" value="Airasia" name="Airline" onclick="OnewayFunctionAirline()"> *@
                                <input type="checkbox" class="selectCheckboxNew" name="Airline" value="Airasia" onclick="getFiltered()">
                             <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>
                            <div class="text-15 ml-10">Air India Express</div>
                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">₹12,997</div>
                    </div>
                </div>
                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                              @*   <input type="checkbox" class="selectCheckboxAirLine" value="AkasaAir" name="Airline" onclick="OnewayFunctionAirline()"> *@
                                <input type="checkbox" class="selectCheckboxNew" name="Airline" value="AkasaAir" onclick="getFiltered()">
                              <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>
                            <div class="text-15 ml-10">Akasa Air</div>
                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">₹12,997</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sidebar__item pb-30">
            <h5 class="text-18 fw-600 mb-10">Price</h5>
            <div class="row x-gap-10 y-gap-30">
                <div class="col-12">
                    <div class="js-price-rangeSlider">
                        <div class="text-14 fw-500"></div>

                        <div class="d-flex justify-between mb-20">
                            <div class="text-15 text-dark-1">
                                <span class="js-lower">$0</span>
                                -
                                <span class="js-upper">$500</span>
                            </div>
                        </div>

                        <div class="px-5">
                            <div class="js-slider noUi-target noUi-ltr noUi-horizontal noUi-txt-dir-ltr"><div class="noUi-base"><div class="noUi-connects"><div class="noUi-connect" style="transform: translate(0%, 0px) scale(0.25, 1);"></div></div><div class="noUi-origin" style="transform: translate(-100%, 0px); z-index: 5;"><div class="noUi-handle noUi-handle-lower" data-handle="0" tabindex="0" role="slider" aria-orientation="horizontal" aria-valuemin="0.0" aria-valuemax="500.0" aria-valuenow="0.0" aria-valuetext="$0"><div class="noUi-touch-area"></div></div></div><div class="noUi-origin" style="transform: translate(-75%, 0px); z-index: 6;"><div class="noUi-handle noUi-handle-upper" data-handle="1" tabindex="0" role="slider" aria-orientation="horizontal" aria-valuemin="0.0" aria-valuemax="2000.0" aria-valuenow="500.0" aria-valuetext="$500"><div class="noUi-touch-area"></div></div></div></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sidebar__item">
            <h5 class="text-18 fw-600 mb-20">Onward Journey</h5>
            <h4 class="text-16 fw-600 mt-10 mb-10">Departing from @Model.simpleAvailabilityRequestModelEdit.origin</h4>
            <div class="sidebar-checkbox">

                <div class="row y-gap-10 items-center justify-between">
                    <div class="flt-bx">
                        <div id="filter-one" class="flt-Tm-slt one" data-departure="before_6am">
                            <div class="btm-time">Before 6 AM</div>
                        </div>

                        <div id="filter-two" class="flt-Tm-slt two" data-departure="6am_to_12pm">
                            <div class="btm-time">6 AM - 12 PM</div>
                        </div>

                        <div id="filter-three" class="flt-Tm-slt three" data-departure="12pm_to_6pm">
                            <div class="btm-time">12 PM - 6 PM</div>
                        </div>

                        <div id="filter-four" class="flt-Tm-slt four" data-departure="after_6pm">
                            <div class="btm-time">After 6 PM</div>
                        </div>
                    </div>
                </div>

            </div>

            <h4 class="text-16 fw-600 mt-20 mb-10">Arrival at @Model.simpleAvailabilityRequestModelEdit.destination</h4>
            <div class="sidebar-checkbox">

                <div class="row y-gap-10 items-center justify-between">
                    <div class="flt-bx">
                        <div id="filter-one" class="flt-Tm-slt one" data-arrival="before_6am">
                            <div class="btm-time">Before 6 AM</div>
                        </div>

                        <div id="filter-two" class="flt-Tm-slt two" data-arrival="6am_to_12pm">
                            <div class="btm-time">6 AM - 12 PM</div>
                        </div>

                        <div id="filter-three" class="flt-Tm-slt three" data-arrival="12pm_to_6pm">
                            <div class="btm-time">12 AM - 6 PM</div>
                        </div>

                        <div id="filter-four" class="flt-Tm-slt four" data-arrival="after_6pm">
                            <div class="btm-time">After 6 PM</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @* stopthird time *@
        <div class="sidebar__item">
            <h5 class="text-18 fw-600 mb-10">Stops</h5>
            <div class="sidebar-checkbox">

                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">
                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="selectCheckbox" value="0" name="stopsCheckbox" onclick="OnewayFunction()">
                                <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>

                            <div class="text-15 ml-10">Nonstop</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">$92</div>
                    </div>
                </div>

                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="selectCheckbox" value="1" name="stopsCheckbox" onclick="OnewayFunction()">
                                <div class="form-checkbox__mark">
                                    <svg class="svg-inline--fa fa-check fa-w-16 form-checkbox__icon" aria-hidden="true" focusable="false" data-prefix="fa" data-icon="check" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"></path></svg><!-- <div class="form-checkbox__icon fa fa-check"></div> -->
                                </div>
                            </div>

                            <div class="text-15 ml-10">1 Stop</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">$92</div>
                    </div>
                </div>

                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="selectCheckbox" value="2" name="stopsCheckbox" onclick="OnewayFunction()">
                                <div class="form-checkbox__mark">
                                    <svg class="svg-inline--fa fa-check fa-w-16 form-checkbox__icon" aria-hidden="true" focusable="false" data-prefix="fa" data-icon="check" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"></path></svg><!-- <div class="form-checkbox__icon fa fa-check"></div> -->
                                </div>
                            </div>

                            <div class="text-15 ml-10">2+ Stops</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">$92</div>
                    </div>
                </div>

            </div>
        </div>
        @* AirLine time *@
        <div class="sidebar__item">
            <h5 class="text-18 fw-600 mb-10">Airlines</h5>
            <div class="sidebar-checkbox">

                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="selectCheckboxAirLine01" value="Airasia" name="Airline" onclick="OnewayFunctionAirline111()">

                                <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>

                            <div class="text-15 ml-10">Air India Express</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">$92</div>
                    </div>
                </div>

                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="selectCheckboxAirLine" value="Indigo" name="Airline" onclick="OnewayFunctionAirline()">

                                <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>

                            <div class="text-15 ml-10">Indigo</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">$45</div>
                    </div>
                </div>

                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="selectCheckboxAirLine" value="Spicejet" name="Airline" onclick="OnewayFunctionAirline()">

                                <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>

                            <div class="text-15 ml-10">Spicejet</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">$21</div>
                    </div>
                </div>
                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="selectCheckboxAirLine" value="AkasaAir" name="Airline" onclick="OnewayFunctionAirline()">

                                <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>

                            <div class="text-15 ml-10">Akasa Air</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">$21</div>
                    </div>
                </div>
                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="selectCheckboxAirLine" value="Vistara" name="Airline" onclick="OnewayFunctionAirline()">

                                <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>

                            <div class="text-15 ml-10">Vistara</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">$21</div>
                    </div>
                </div>
                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="selectCheckboxAirLine" value="AirIndia" name="Airline" onclick="OnewayFunctionAirline()">

                                <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>

                            <div class="text-15 ml-10">AirIndia</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">$21</div>
                    </div>
                </div>

                <div class="row y-gap-10 items-center justify-between">
                    <div class="col-auto">

                        <div class="d-flex items-center">
                            <div class="form-checkbox ">
                                <input type="checkbox" class="selectCheckboxAirLine" value="Hahnair" name="Airline" onclick="OnewayFunctionAirline()">

                                <div class="form-checkbox__mark">
                                    <div class="form-checkbox__icon fa fa-check"></div>
                                </div>
                            </div>

                            <div class="text-15 ml-10">Hahnair</div>

                        </div>

                    </div>

                    <div class="col-auto">
                        <div class="text-15 text-light-1">$21</div>
                    </div>
                </div>
            </div>
        </div>


    </div>
</aside>
<style>

    .flt-Tm-slt.active {
        background-color: #007bff; /* Change this to your desired active color */
        color: #007bff;
        /* Text color when active */
    }

</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

    // let selectedDepartureTimes = [];
    // let selectedArrivalTimes = [];
    // $('.flt-Tm-slt').click(function () {
    //     debugger;
    //     let departureTime = $(this).data('departure');
    //     let arrivalTime = $(this).data('arrival');
    //     $(this).toggleClass('active');
    //     if ($(this).hasClass('active')) {
    //         debugger;
    //         selectedDepartureTimes.push(departureTime);
    //         selectedArrivalTimes.push(arrivalTime);
    //     } else {
    //         debugger;
    //         selectedDepartureTimes = selectedDepartureTimes.filter(function (item) {
    //             return item !== departureTime;
    //         });
    //         selectedArrivalTimes = selectedArrivalTimes.filter(function (item) {
    //             return item !== arrivalTime;
    //         });
    //     }
    //     $.ajax({
    //         url: '/ResultFlightView/FlightViewFilter',
    //         type: 'GET',
    //         traditional: true,
    //         data: {
    //             departure: selectedDepartureTimes,
    //             arrival: selectedArrivalTimes
    //         },
    //         success: function (response) {
    //             $('#flight-results').html(response);
    //         },
    //         error: function (error) {
    //             console.log('Error filtering flights:', error);
    //         }
    //     });
    // });


    function OnewayFunctionTimeFilter() {
        let selectedDepartureTimes = [];
        let selectedArrivalTimes = [];

        // Assuming you use checkboxes or another form element that can trigger 'change'
        $('.checkdepart').on('change', function () {
            debugger;
            let departureTime = $(this).data('departure');
            let arrivalTime = $(this).data('arrival');
            if ($(this).is(':checked')) {
                selectedDepartureTimes.push(departureTime);
                selectedArrivalTimes.push(arrivalTime);
            } else {
                selectedDepartureTimes = selectedDepartureTimes.filter(function (item) {
                    return item !== departureTime;
                });
                selectedArrivalTimes = selectedArrivalTimes.filter(function (item) {
                    return item !== arrivalTime;
                });
            }

            updateFlightViewFilter();
        });

        function updateFlightViewFilter() {
            debugger;
            $.ajax({
                url: '/ResultFlightView/GetFilteredFlights',
                type: 'POST',
                traditional: true,
                data: {
                    departure: selectedDepartureTimes,
                    arrival: selectedArrivalTimes
                },
                success: function (response) {
                    $('#flight-results').html(response);
                    restoreTimeFilterData();
                },
                error: function (error) {
                    console.log('Error filtering flights:', error);
                }
            });
        }

        function restoreTimeFilterData() {
            $('.flt-Tm-slt').each(function () {
                let departureTime = $(this).data('departure');
                let arrivalTime = $(this).data('arrival');
                if (selectedDepartureTimes.includes(departureTime) && selectedArrivalTimes.includes(arrivalTime)) {
                    $(this).prop('checked', true);
                } else {
                    $(this).prop('checked', false);
                }
            });
        }
    }


    function OnewayFunctionAirline() {
        debugger;
        $('.selectCheckboxAirLine').on('change', function () {
            updatedataFilter();
        });
        function updatedataFilter() {
            debugger;
            var FilterIdAirLine = [];
            $('input.selectCheckboxAirLine:checked').each(function () {
                FilterIdAirLine.push($(this).val());
            });
            $.ajax({
                url: '/ResultFlightView/GetFilteredFlights',
                type: 'POST',
                traditional: true,
                data: { FilterIdAirLine: FilterIdAirLine },
                success: function (response) {
                    $('#flight-results').html(response);
                    restoreCheckboxData(FilterIdAirLine);
                },
                error: function (xhr, status, error) {
                    console.error('Error occurred:', error);
                }
            });
        }
        function restoreCheckboxData(FilterIdAirLine) {
            $('.selectCheckboxAirLine').each(function () {
                var checkboxValue = $(this).val();
                $(this).prop('checked', FilterIdAirLine.includes(checkboxValue));
            });
        }
    }

    function OnewayFunction() {
        debugger;
        $('.selectCheckbox').on('change', function () {
            updatedataFilter();
        });
        function updatedataFilter() {
            var FilterId = [];
            $('input.selectCheckbox:checked').each(function () {
                FilterId.push($(this).val());
            });
            $.ajax({
                url: '/ResultFlightView/GetFilteredFlights',
                type: 'POST',
                traditional: true,
                data: { FilterId: FilterId },
                success: function (response) {
                    $('#flight-results').html(response);
                    restoreCheckboxData(FilterId);
                },
                error: function (xhr, status, error) {
                    console.error('Error occurred:', error);
                }
            });
        }
        function restoreCheckboxData(FilterId) {
            debugger;
            $('.selectCheckbox').each(function () {
                var checkboxValue = $(this).val();
                $(this).prop('checked', FilterId.includes(checkboxValue));
            });
        }
    }
   
    
    function OnewayFunctionFirst() {
        debugger;
        $('.selectCheckboxnon').on('change', function () {
            updatedataFilter();
        });
        function updatedataFilter() {
            var FilterId = [];
            $('input.selectCheckboxnon:checked').each(function () {
                FilterId.push($(this).val());
            });
            $.ajax({
                url: '/ResultFlightView/GetFilteredFlights',
                type: 'POST',
                traditional: true,
                data: { FilterId: FilterId },
                success: function (response) {
                    $('#flight-results').html(response);
                    restoreCheckboxData(FilterId);
                },
                error: function (xhr, status, error) {
                    console.error('Error occurred:', error);
                }
            });
        }
        function restoreCheckboxData(FilterId) {
            debugger;
            $('.selectCheckboxnon').each(function () {
                var checkboxValue = $(this).val();
                $(this).prop('checked', FilterId.includes(checkboxValue));
            });
        }
    }



    function getFiltered() {
        // Collect checkbox values
        debugger;
        let filterIdAirLine = [];
        let filterId = [];
        let departure = [];
        let arrival = [];

        //Assuming checkboxes have class 'selectCheckbox' and unique values for each category
        $('.selectCheckboxNew').each(function () {
            if ($(this).is(':checked')) {
                let name = $(this).attr('name');
                let value = $(this).val();

                if (name === 'Airline') {
                    filterIdAirLine.push(value);
                } else if (name === 'stops') {
                    filterId.push(parseInt(value, 10)); //Convert value to integer
                } else if (name === 'departure') {
                    departure.push(value);
                } else if (name === 'arrival') {
                    arrival.push(value);
                }
            }
        });

        // Send data to the server
        $.ajax({
            url: '/ResultFlightView/GetFilteredFlights',
            type: 'POST', // or 'POST' depending on your preference
            data: {
                //sortOrderName: 'yourSortOrderName', 
                FilterIdAirLine: filterIdAirLine,
                FilterId: filterId,
                departure: departure,
                arrival: arrival
            },
            success: function (response) {
                // Handle the response from the server
                $('#flight-results').html(response);
                console.log(response);
            },
            error: function (xhr, status, error) {
                // Handle any errors
                console.error(error);
            }
        });
    }



</script>




